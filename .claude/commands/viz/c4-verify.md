# C4 Architecture Verification

Validate the accuracy and completeness of a C4 architecture map.

## Prerequisites

C4 model must exist in `codemap/` folder (generated by `/viz/c4-map`).

Read all codemap files first:
- `codemap/README.md`
- `codemap/context.md`
- `codemap/containers.md`
- `codemap/components.md`
- `codemap/code.md`

## Instructions

Use the Task tool to spawn 3 parallel Explore agents. Each agent verifies a different aspect.

### Agent 1: Completeness Check

```
Read codemap/context.md, codemap/containers.md, codemap/components.md, codemap/code.md.

Verify COMPLETENESS of the C4 map against the actual codebase:

1. Container completeness:
   - Scan for all package.json, requirements.txt, Dockerfile, docker-compose files
   - Check for any deployable units not in the map
   - Verify all databases and services are listed

2. Component completeness:
   - List all top-level directories under src/ (or equivalent)
   - Compare against components in the map
   - Identify orphan modules not mapped to any component

3. Entry point completeness:
   - Find all route definitions, API endpoints, CLI commands
   - Verify all entry points are documented

4. External system completeness:
   - Grep for HTTP clients, SDK imports, API keys
   - Verify all integrations are in the context diagram

Return:
- List of missing containers (if any)
- List of unmapped components (if any)
- List of undocumented entry points (if any)
- List of missing external systems (if any)
```

### Agent 2: Accuracy Check

```
Read codemap/context.md, codemap/containers.md, codemap/components.md, codemap/code.md.

Verify ACCURACY of the C4 map against the actual codebase:

1. Relationship accuracy:
   - For each documented relationship, verify it exists in code
   - Check import statements match component dependencies
   - Verify API calls match container relationships

2. Technology labels:
   - Verify framework versions in package.json/requirements.txt
   - Check database types match actual connections
   - Validate protocol labels (REST, gRPC, etc.)

3. Component boundaries:
   - Verify module boundaries match actual code organization
   - Check for undocumented cross-component dependencies
   - Identify circular dependencies not shown

4. Naming consistency:
   - Compare diagram names with actual file/folder names
   - Flag any mismatches or outdated names

Return:
- List of incorrect relationships (with corrections)
- List of wrong technology labels (with corrections)
- List of boundary violations found
- List of naming inconsistencies
```

### Agent 3: Diagram Validation

```
Read codemap/context.md, codemap/containers.md, codemap/components.md, codemap/code.md.

Verify DIAGRAM QUALITY of the C4 map:

1. Mermaid syntax:
   - Check all diagram blocks for valid Mermaid syntax
   - Verify C4 diagram types are used correctly
   - Test that diagrams would render

2. Cross-level consistency:
   - Containers in Level 2 should appear in Level 1 system
   - Components in Level 3 should map to Level 2 containers
   - Classes in Level 4 should map to Level 3 components

3. Naming conventions:
   - IDs should be consistent across diagrams
   - Labels should be descriptive and concise
   - Relationship labels should describe the interaction

4. Coverage balance:
   - No single diagram should be overloaded (>15 elements)
   - Important components should have code-level detail
   - Trivial utilities don't need code-level diagrams

Return:
- List of syntax errors (with fixes)
- List of cross-level inconsistencies
- List of naming issues
- Recommendations for diagram balance
```

## After All Agents Complete

Consolidate into a verification report and write to `codemap/VERIFICATION.md`:

```markdown
# C4 Verification Report

<!-- Verified: YYYY-MM-DD -->

## Completeness
- [ ] All containers identified
- [ ] All major components mapped
- [ ] All entry points documented
- [ ] All external systems listed

### Gaps Found
[Agent 1 findings]

## Accuracy
- [ ] Relationships verified against code
- [ ] Technology labels correct
- [ ] Component boundaries accurate
- [ ] Names match codebase

### Corrections Needed
[Agent 2 findings]

## Diagram Quality
- [ ] Mermaid syntax valid
- [ ] Cross-level references aligned
- [ ] Naming consistent
- [ ] Coverage balanced

### Fixes Needed
[Agent 3 findings]

## Summary
[PASS/FAIL with key issues]

## Recommended Corrections
[Prioritized list of specific edits to the C4 map files]
```

Write this report to `codemap/VERIFICATION.md` and output confirmation.
